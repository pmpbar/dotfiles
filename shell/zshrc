#  -- Exports --
export DOTFILES="$HOME/.dotfiles"
export TERM="screen-256color"
export EDITOR=vim
export PATH="/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin:$HOME/.bin:$HOME/.cargo/bin:$HOME/.rvm/bin"
export ZSH=$HOME/.oh-my-zsh
export MANPAGER="sh -c \"col -b | vim --not-a-term -c 'set ft=man ts=8 nomod nolist nonu' \
  -c 'nnoremap i <nop>' \
  -c 'nnoremap <Space> <C-f>' \
  -c 'noremap q :quit<CR>' -\""
# Enable command auto-correction.
export ENABLE_CORRECTION=true
export DISABLE_AUTO_TITLE=true

# zsh plugins
platform=$(uname)
if [ "$platform" = "Darwin" ]; then
  plugins=(
    docker
    docker-compose
    git
  )
elif [ -f /etc/debian_version ]; then
  plugins=(
    git
    sudo
    debian
    docker-compose
  )

elif [ -f /etc/redhat-release ]; then
  plugins=(
    git
    sudo
    fedora
  )
elif [ -f /etc/arch-release ]; then
  plugins=(
    git
    sudo
  )
elif `grep -Fq Amazon /etc/system-release`; then
  plugins=(
    git
    sudo
    docker
    docker-compose
    )
fi
source $ZSH/oh-my-zsh.sh
# theme
source $DOTFILES/shell/zsh-prompt.zsh-theme

biggest() {
  du -a $1 | sort -n -r | head -n 5
}

function whereisip() {
  curl ipinfo.io/$1
}

# -- Aliases --
alias q="exit"
alias :q="exit"
alias zshrc="nvim ~/.zshrc && . ~/.zshrc"
alias startredis="docker run -p 6379:6379 redis"
alias dev="ENV=development"
alias lzd="lazydocker"
alias virtualenv="python3 -m virtualenv"

# Git Aliases
alias gs="git status"
alias gcm="git commit -m"
alias gd="git diff --patience --ignore-space-change"
alias gpo=" git pull origin"
alias gpom=" git pull origin master"
alias gitadddeleted="git ls-files --deleted -z | xargs -0 git rm"
alias gitdisabledirty="git config --add oh-my-zsh.hide-dirty 1"
alias gitremovemerged="git branch --merged dev | grep -v dev | xargs -n 1 git branch -d"

# Platform Specific
platform=$(uname)
if [ "$platform" = "Darwin" ]; then
  alias copy="pbcopy"
  alias grep="grep -RIns --color=auto --exclude=\"tags\""
  alias ls="ls -G -l -h"
  alias lsusb="system_profiler SPUSBDataType"
  alias newmacaddr="openssl rand -hex 6 | sed 's/\(..\)/\1:/g; s/.$//' | xargs sudo ifconfig en0 ether"
  alias showhidden="defaults write com.apple.finder AppleShowAllFiles"
  alias ctags="`brew --prefix`/bin/ctags"
  alias update="brew update && brew upgrade"
  alias install="brew install"
  function remove() {
    brew rm $1
    brew rm $(join <(brew leaves) <(brew deps $1))
  }
function title {
  echo -ne "\033]0;"$*"\007"
}
# Usage: $ notify Title content
function notify {
  osascript -e "display notification \"$2\" with title \"$1\" sound name \"Ping\""
}
alias -s go="go run"
else
  # alias grep="grep -RIns --color --exclude=\"tags\""
  alias ls="ls -lh --color"
  alias xup="xrdb ~/.Xresources"
  alias open="xdg-open"
  alias copy="xclip -sel clip"

  if [ -f /etc/debian_version ]; then
    alias update="sudo apt-get update && sudo apt-get upgrade && sudo apt-get dist-upgrade && sudo apt-get autoremove"
    alias install="sudo apt-get install"
    alias remove="sudo apt-get autoremove"

    xmodmap ~/.xmodmap > /dev/null 2>&1

  elif [ -f /etc/redhat-release ]; then
    alias update="sudo dnf update"
    alias install="sudo dnf install"
    alias remove="sudo dnf remove"
  elif [ -f /etc/arch-release ]; then
    alias update="yay -Syu"
    alias install="yay -S"
    alias remove="yay -R"
  elif `grep -Fq Amazon /etc/system-release`; then
    alias update="sudo yum update"
    alias install="sudo yum install"
    alias remove="sudo yum remove"
  fi
fi

# -- Functions --
alias newpw="head -c 500 /dev/urandom | tr -dc 'a-zA-Z0-9~!@#$%^&*_-' | fold -w 32 | head -n 1 | copy"
# -- Plugins --
# source if exist
function sife() {
  [ -f $1 ] && source $1
}
sife ~/.fzf.zsh
sife $DOTFILES/shell/z/z.sh
sife $DOTFILES/shell/zsh-plugins/zsh-autosuggestions/zsh-autosuggestions.zsh
bindkey '^E' autosuggest-accept
export ZSH_AUTOSUGGEST_USE_ASYNC=1

autoload -U +X bashcompinit && bashcompinit
[ -f /usr/local/bin/mc ] && complete -o nospace -C /usr/local/bin/mc mc

# -- Sources --
sife $HOME/.zshrc.local
